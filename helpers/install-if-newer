#!/bin/bash

[[ -z $ROOT ]] && echo "ROOT: missing" && exit 1
[[ $# != 2 ]] && echo "Usage: $0 <src> <cmd>" && exit 1

src=$1
cmd=$2

packages=$ROOT/packages/$src
packages_marker=$ROOT/state/packages-$src

[[ ! -f $packages ]] && echo "No packages to install, missing: $packages" && exit 0
[[ $packages -ot $packages_marker ]] && exit 0

packages="$(grep -v '^#' $packages | tr '\n' ' ')"

echo "$src: installing: $packages"
eval "$cmd $packages"
touch $packages_marker

#!/bin/bash
# run a command once only if the state file doesn't exist

state=$1
cmd=$2

if [[ -z $state || -z $cmd ]]; then
    echo "Usage: $0 <state-file> <command>"
    exit 1
fi

marker=$ROOT/state/$1

if [[ ! -f $marker ]]; then
    echo "$state: running once"

    if eval "$cmd"; then
        mkdir -p $(dirname $marker)
        touch $marker
    fi
fi
